# FSWatcherEngineEvent

is a powershell module which notifies of filesystem changes using a Powershell engine events.

A new event handler can be created with the cmdlet New-FileSystemWatcher:

## How to Install

FSWatcherEngineEvent is published to the [Powershell Gallery](https://www.powershellgallery.com/packages/FSWatcherEngineEvent). To Install it locally you can user PowerShellGets ```Install-Module``` command:

```powershell
Install-Module -Name FSWatcherEngineEvent	
```

## Watch for changes and receive the event

```powershell
PS> New-FileSystemWatcher -SourceIdentifier "myevent" -Path c:\temp\files
```

The parameter 'SourceIdentifier' is the unique name of the powershell engine event generated by the FileSystemWatcher. The other parameters of the cmdlet correspond to the properties of the .Net [FileSystemWatcher](https://docs.microsoft.com/en-us/dotnet/api/system.io.filesystemwatcher) class.

To receive the event an event handler must be registered for the source identifier. Powershell will write the subscription to the pipe.

```powershell
PS> Register-EngineEvent -SourceIdentifier "myevent" -Action { $event | ConvertTo-Json | Write-Host }

Id     Name            PSJobTypeName   State         HasMoreData     Location             Command
--     ----            -------------   -----         -----------     --------             -------
1      myevent                         NotStarted    False                                $event|ConvertTo-Json|Wrâ€¦
```

The above action will simply dump the whole event to the console. You will recive something like this:

```powershell
# change a file in the watched directory
PS> "XYZ" >> C:\temp\files\xyz

{
  "ComputerName": null,
  "RunspaceId": "b92c271b-c147-4bd6-97e4-ffc2308a1fcc",
  "EventIdentifier": 4,
  "Sender": {
    "NotifyFilter": 19,
    "Filters": [],
    "EnableRaisingEvents": true,
    "Filter": "*",
    "IncludeSubdirectories": false,
    "InternalBufferSize": 8192,
    "Path": "D:\\tmp\\files\\",
    "Site": null,
    "SynchronizingObject": null,
    "Container": null
  },
  "SourceEventArgs": null,
  "SourceArgs": null,
  "SourceIdentifier": "myevent",
  "TimeGenerated": "2021-03-13T21:39:50.4483088+01:00",
  "MessageData": {
    "ChangeType": 4,
    "FullPath": "C:\\temp\\files\\xyz",
    "Name": "xyz"
  }
}
```

While there can be only one FileSystemWatcher for a source identifier it is possible to register multiple event handlers for the same source identifier.
To inspect the current registrations you may use powershells Get-EventSubscriber command:

```powershell
PS> Get-EventSubsciber

SubscriptionId   : 1
SourceObject     : 
EventName        : 
SourceIdentifier : fswatch
Action           : System.Management.Automation.PSEventJob
HandlerDelegate  : 
SupportEvent     : False
ForwardEvent     : False
```

You may also inspect the state of the FileSystemWatchers. It will write the current state of the watcher and its configuration to the pipe:

```powershell
PS>  Get-FileSystemWatcher

SourceIdentifier      : myevent
Path                  : C:\temp\files\
NotifyFilter          : FileName, DirectoryName, LastWrite
EnableRaisingEvents   : True
IncludeSubdirectories : False
Filter                : *
```

## Suspend and resume watching

The notifications can be suspendend and resumed without disabling the FileSystemWatcher or unregistering the event handlers:

```powershell
PS> Suspend-FileSystemWatcher -SourceIdentifier "myevent"

PS> Resume-FileSystemWatcher -SourceIdentifier "myevent"
```

## Stop watching and cleaning up

If no longer needed the FileSystemWatcher can be disposed:

```powershell
PS> Remove-FileSystemWatcher -SourceIdentifier "myevent"
```

Optionally you may also unregister the event handlers:

```powershell
PS> Get-EventSubscriber -SourceIdentifier "myevent" | Unregister-Event
```
